<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- <script>
        const add1 = (x) => x + 1;
        const mul3 = (x) => x * 3;
        const div2 = (x) => x / 2;
        div2(mul3(add1(add1(0)))); //=>3

        function compose(...fn) {
            return function (val) {
                return fn.reverse().reduce((acc, cur) => {
                    return cur(acc)
                }, val)
            }
        }

        let composeFun = compose(add1, add1, mul3, div2)
        let result = composeFun(0)
        console.log(result)
    </script> -->
    <!-- <script>
        function add(){
            let args = Array.prototype.slice.call(arguments)
            function add_(){
                let new_args = Array.prototype.slice.call(arguments)
                args.push(...new_args)
                return add_
            }
            add_.toString = function(){
                return  args.reduce((acc, cur) => {
                    return acc + cur
                })
            }
            return add_
        }
        console.log(add(1)(2)(3).toString())
    </script> -->
    <script>
        class Scheduler {
            constructor() {
                this.list = []
                this.maxCount = 3
                this.currentIndex = 0

            }
            add = function (fn) {
                this.list.push(fn)
            }
            taskStart = function () {
                for (let i = 0; i < this.maxCount; i++) {
                    this.request()
                }
            }
            request = function () {
                if (this.list.length === 0 || this.currentIndex > this.list.length) return
                this.currentIndex++
                this.list.shift()().then(() => {
                    this.currentIndex--
                    this.request()
                })
            }

        }
        let scheduler = new Scheduler()

        function timeout(time) {
            return new Promise(resolve => {
                setTimeout(resolve, time)
            })
        }

        function addTask(time, order) {
            scheduler.add(() => timeout(time).then(() => console.log(order)))
        }


        addTask(1000, 1)
        addTask(5000, 1)
        addTask(300, 3)
        addTask(400, 4)

        scheduler.taskStart()
    </script>
</body>

</html>